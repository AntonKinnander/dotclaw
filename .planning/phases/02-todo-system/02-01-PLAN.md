# PLAN 02-01: Task Breakdown Subagent

## Objective

Create a subagent capability that takes a high-level task and breaks it down into atomic subtasks (max 10). This will be used during daily planning when the user agrees on major tasks.

## Context

@file:src/ipc-dispatcher.ts - Existing `spawn_subagent` action
@file:src/types.ts - DailyTask type definition

## Tasks

### Task 1: Create task breakdown skill for subagent

**Type:** `task` | **Files:** `global/skills/task-breakdown/SKILL.md` (new skill)

**Action:**
Create a skill specifically for task decomposition:

```markdown
---
name: task-breakdown
description: Break down high-level tasks into atomic, actionable subtasks (max 10)
license: MIT
---

# Task Breakdown

You are a task breakdown specialist. Take high-level tasks and decompose them into atomic, actionable subtasks.

## Breakdown Guidelines

1. **Max 10 subtasks** - Keep it focused and manageable
2. **Each subtask must be:**
   - Atomic (can be completed independently)
   - Actionable (clear what "done" means)
   - Sized appropriately (1-4 hours of work)
   - Specific (not vague like "research X")

3. **Subtask Format:**
   - `[Emoji] Task title` (max 55 characters)
   - Emojis should be semantic (üîß for fix, ‚ú® for feature, üìù for doc, etc.)

## Breakdown Process

Given a task like "Fix authentication bug":
1. Understand the scope (ask questions if needed)
2. Identify the key steps
3. Order them logically
4. Add emojis and format titles

Example output:
```json
[
  "üîç Reproduce the authentication bug",
  "üêõ Identify root cause in login flow",
  "üíª Write fix for token validation",
  "üß™ Add unit tests for fix",
  "‚úÖ Test fix in staging environment",
  "üöÄ Deploy fix to production"
]
```

## Context Available

You may have access to:
- Repository structure (if provided)
- Existing related tasks
- User's project context

Use this to create more informed breakdowns.

## Output Format

Return a JSON array of subtask strings, each starting with an emoji.
```

**Verify:**
- Skill file exists and is valid
- Agent can use skill when spawned as subagent
- Breakdown format matches requirements

**Done when:** Skill produces quality task breakdowns

---

### Task 2: Create task breakdown orchestrator

**Type:** `task` | **Files:** `src/task-breakdown.ts` (new)

**Action:**
Create a module that orchestrates the breakdown process:

```typescript
export interface BreakdownRequest {
  group_folder: string;
  main_task: string;
  context?: {
    repo?: string;
    url?: string;
    calendar_link?: string;
    description?: string;
  };
}

export interface BreakdownResult {
  main_task: string;
  subtasks: Array<{
    title: string;  // with emoji prefix
    emoji: string;
    description?: string;
  }>;
}

export async function breakdownTask(request: BreakdownRequest): Promise<BreakdownResult>;
```

Implementation:
1. Spawn subagent with task-breakdown skill
2. Provide context about the task
3. Parse and validate subtask output
4. Return structured result

**Verify:**
- Function compiles and exports correctly
- Can spawn subagent successfully
- Returns valid breakdown results

**Done when:** Orchestrator can breakdown tasks end-to-end

---

### Task 3: Add IPC action for task breakdown

**Type:** `task` | **Files:** `src/ipc-dispatcher.ts`

**Action:**
Add IPC action `breakdown_task`:

```typescript
case 'breakdown_task': {
  const mainTask = typeof payload.main_task === 'string' ? payload.main_task.trim() : '';
  if (!mainTask) {
    return { id: requestId, ok: false, error: 'main_task is required' };
  }

  const result = await breakdownTask({
    group_folder: sourceGroup,
    main_task: mainTask,
    context: payload.context,
  });

  return { id: requestId, ok: true, result };
}
```

**Verify:**
- Agent can call breakdown via IPC
- Subtask count is ‚â§ 10
- Each subtask has emoji prefix
- Titles are ‚â§ 55 characters

**Done when:** IPC action produces valid breakdowns

---

## Verification (Overall)

1. **Skill Check:**
   - Task-breakdown skill exists
   - Produces quality breakdowns

2. **Orchestrator Check:**
   - Can spawn subagent
   - Returns structured results

3. **IPC Check:**
   - Agent can breakdown tasks via IPC
   - Output format is correct

## Success Criteria

- [ ] Task breakdown skill exists and produces quality output
- [ ] Orchestrator module manages subagent spawning
- [ ] IPC action allows agent to request breakdowns
- [ ] Output matches format: emoji prefix, max 55 chars, max 10 items

## Output

SUMMARY.md should contain:
- Skill created at `global/skills/task-breakdown/SKILL.md`
- Orchestrator module at `src/task-breakdown.ts`
- IPC action added
- Example breakdown outputs
